{
  "hash": "06ff6bd2a81d1ce2694d10443ffd3ca6",
  "result": {
    "markdown": "---\ntitle: \"Analyse des données\"\ntitle-block-banner: true\ndescription: | \n  Résumé des analyses faites aux données.\n# à changer\ndate: \"2022-12-21\"\n# Modifier les détails que vous voulez\nauthor:\n  - name: \"Rémi Turcot-Roy\"\n    # Votre site web perso ou github\n    url: https://github.com/rTurcotroy\n    # les champs d'affiliation sont optionnels, vous pouvez les\n    # comment out en ajoutant un # devant.\n    affiliation: FAS1002\n    affiliation-url: https://FAS1002.github.io/A22\n    # changer pour votre propre orcid id\n    # https://orcid.org/ pour vous inscrire.\n    orcid: 0000-0000-0000-0000\n\n# TRUE == Générer une citation pour cette page précise. Pour enlever, mettre false.\ncitation: true\n# Inclure les références que vous utilisez dans vos rapports. Je conseille Zotero pour construire\n# ce fichier ou de connecter RStudio directement pour pouvoir citer avec @nom-de-reference.\nbibliography: references.bib\n---\n\n::: {.cell}\n\n:::\n\n\n## Introduction\n\nAvant de débuter les analyses, il a fallu retravailler les bases de données. Ainsi, pour cela il a fallu sélectionner les variables qui semblaient être intéressantes pour l'analyse. Considérant que l'analyse porte sur l'espérance de vie nous avons sélectionnés des variables qui nous semblais avoir un impact potentiel sur celle-ci. Cela a donc mené à sélectionner 13 variables différentes pour un total de 12832 observations. Toutefois, les observations ne sont pas toutes complètes. Ce qui a complexifié la seconde analyse, puisque la majorité des Na retrouvés sont dans les variables de production et de consommation d'énergie.\n\nLes actions qui sont donc produites ci-dessous permettent d'importer les banques de données préalablement téléchargées. Elles sont par la suite intégrées l'une à l'autre via les indicateurs de pays et d'années pour créer une seule base de données. Un nettoyage des variables et des données est fait par la suite et nous créer de nouvelle variable pour facilité la création de graphiques. Il reste donc une base donnée avec les variables choisies préalablement ou l'on a ajouté nos variables et enlevé le plus de données manquantes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbas_path <- path(\"data\", \"raw\")\nCo2_name <- paste(today(), \"Co2_data.csv\", sep = \"_\") \nenergy_name <- paste(month(today()), \"energy_data.csv\", sep = \"_\") \nexpectancy_name <- paste(month(today()), \"expectancy_data.xlsx\", sep = \"_\")  \n \nCo2_data <-  read.csv(file = path(bas_path, Co2_name))\nEnergy_data <- read.csv(file = path(bas_path, energy_name))\nexpectancy_data  <- read_excel(\"data/raw/12_expectancy_data.xlsx\", \n    sheet = \"countries_and_territories\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nCo2_data$continent <- countrycode(sourcevar = Co2_data[, \"country\"],\n                            origin = \"country.name\",\n                            destination = \"continent\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in countrycode_convert(sourcevar = sourcevar, origin = origin, destination = dest, : Some values were not matched unambiguously: Africa, Africa (GCP), Antarctica, Asia, Asia (excl. China and India), Asia (GCP), Central America (GCP), Europe, Europe (excl. EU-27), Europe (excl. EU-28), Europe (GCP), European Union (27), European Union (27) (GCP), European Union (28), French Equatorial Africa (GCP), French West Africa (GCP), High-income countries, International transport, Kosovo, Leeward Islands (GCP), Low-income countries, Lower-middle-income countries, Micronesia (country), Middle East (GCP), Non-OECD (GCP), North America, North America (GCP), Oceania, Oceania (GCP), OECD (GCP), Ryukyu Islands (GCP), South America, South America (GCP), St. Kitts-Nevis-Anguilla (GCP), Timor, Upper-middle-income countries, World\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in countrycode_convert(sourcevar = sourcevar, origin = origin, destination = dest, : Some strings were matched more than once, and therefore set to <NA> in the result: Asia (excl. China and India),Asia,Asia; St. Kitts-Nevis-Anguilla (GCP),Americas,Americas\n```\n:::\n\n```{.r .cell-code}\nexpectency_modifier <- expectancy_data %>% \n  pivot_longer(matches(\"[0-9][0-9][0-9][0-9]\"),\n               names_to = \"year\",\n               values_to = \"M_age\") %>% \n    select(-indicator.name, -indicator, -geo) %>% \n    rename(\"country\" = \"geo.name\")\n\nexpectancy_Co2 <- merge(expectency_modifier, Co2_data, by = c(\"country\",\"year\"))\nexpectancy_Co2_energi <- merge(expectancy_Co2, Energy_data, by = c(\"country\", \"year\"))\n\nexpectancy_Co2_energi <- expectancy_Co2_energi %>% \n    mutate(year = as.numeric(year),\n           M_age = as.numeric(M_age))\n\n\ndata_final <- expectancy_Co2_energi %>% \n    group_by(year, continent) %>% \n    drop_na(M_age) %>% \n    drop_na(co2_per_capita) %>% \n    mutate(moyenneAge = mean(M_age),\n           moyenneCo2 = mean(co2),\n           moyenneCo2Cap = mean(co2_per_capita)) %>%\n    ungroup() %>% \n    mutate(population  = as.numeric(population.x),\n           moyenneAge = round(moyenneAge)) %>% \n    select(country, year, M_age, population, co2, co2_per_capita, electricity_demand, electricity_generation, energy_per_capita.x, continent,\n           moyenneAge,moyenneCo2, moyenneCo2Cap)\n\ndata_energi <- expectancy_Co2_energi%>% \n    select(country, year, M_age, population.x, co2, electricity_generation, continent) %>% \n    drop_na(electricity_generation, co2) %>% \n    group_by(year, continent) %>% \n    mutate(moyenneElec = mean(electricity_generation),\n           moyenneCo2 = mean(co2)) %>% \n    ungroup()\n\ntable(data_final$continent)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  Africa Americas     Asia   Europe  Oceania \n    3008     2623     3500     3079      622 \n```\n:::\n:::\n\n\n## Analyse de l'expérance de vie selon le continent\n\nLa première analyse se tourne vers l'impact de la localisation d'un individu sur son espérance de vie. Pour comprendre cette impacte nous allons effectuer une régression linéaire multiple avec comme variable dépendante l'espérance de vie et variable indépendante le continent. De plus, nous avons ajouté des variables de contrôle telles que : l'année, la population et le co2 émit.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreg_age <- lm(M_age~ continent+year+population+co2, data=data_final)\nsummary(reg_age)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = M_age ~ continent + year + population + co2, data = data_final)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-45.192  -4.824   0.522   5.079  18.462 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)       -6.500e+02  4.053e+00 -160.40   <2e-16 ***\ncontinentAmericas  1.155e+01  1.956e-01   59.04   <2e-16 ***\ncontinentAsia      7.954e+00  1.846e-01   43.09   <2e-16 ***\ncontinentEurope    1.751e+01  1.899e-01   92.20   <2e-16 ***\ncontinentOceania   1.231e+01  3.188e-01   38.61   <2e-16 ***\nyear               3.550e-01  2.039e-03  174.12   <2e-16 ***\npopulation        -1.243e-08  7.369e-10  -16.86   <2e-16 ***\nco2                3.017e-03  1.502e-04   20.09   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 7.233 on 12824 degrees of freedom\nMultiple R-squared:  0.7406,\tAdjusted R-squared:  0.7404 \nF-statistic:  5230 on 7 and 12824 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nLa régression montre donc une certaine corrélation entre l'espérance de vie et le continent. Ainsi, l'espérance de vie est croissante, peu importe le continent, mais elles n'ont pas toute la même valeur. L'espérance de vie semble donc plus croissante en Europe qu'en Afrique par exemple. Les variables de contrôle semblent-elles aussi avoir une influence. Toutefois, elles ont un moyen grand impacte au vu des estimations. Néanmoins, la population semble être un frein à la croissance de l'espérance de vie. Ce qui est un résultat intéressant qui demanderait plus de recherche. Et pour ça, par le co2 semble être un plus à cette croissance.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_final,\n       aes(year, moyenneAge, color = continent))+\n    geom_line()\n```\n\n::: {.cell-output-display}\n![](exploration_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nVisuellement il est donc facile de voir cet avantage que certains continents ont sur les autres. Il se semblerait toutefois, que l'Océanie a eu des modifications drastiques de son espérance de vient vers l'an 1980. Cela peut provenir de nouveaux jeux de données qui ont fait leur entrée dans la base de données ou bien un évènement qui aurait impacté l'ensemble du continent. Malheureusement, par manque de temps ils nous étaient impossibles de vérifier ces hypothèses.\n\n## Analyse de la production de Co2\n\nLa seconde analyse vise à comprendre ce qui pourrait expliquer la production de co2. Pour cela nous avons créé une nouvelle base de données qui a permis de créer la moyenne de co2 par continent. Ainsi, le premier test à faire était une régression linéaire multiple comme vue précédemment. Nous avons donc pris comme variable dépendante la production de co2 qui est impactée par la variable indépendante de la génération d'électricité. Nous avons par la suite ajouté quelque variables contrôles tels que la population et le continent.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreg_age_continent <- lm(moyenneCo2 ~ electricity_generation + population.x + continent, data = data_energi)\nsummary(reg_age_continent) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = moyenneCo2 ~ electricity_generation + population.x + \n    continent, data = data_energi)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-190.37  -51.53  -10.20    2.12  438.47 \n\nCoefficients:\n                         Estimate Std. Error t value Pr(>|t|)    \n(Intercept)             2.907e+01  2.479e+00  11.726  < 2e-16 ***\nelectricity_generation  2.884e-02  3.205e-03   9.000  < 2e-16 ***\npopulation.x           -3.531e-08  1.057e-08  -3.340 0.000845 ***\ncontinentAmericas       2.220e+02  3.631e+00  61.133  < 2e-16 ***\ncontinentAsia           2.887e+02  3.407e+00  84.737  < 2e-16 ***\ncontinentEurope         1.477e+02  3.455e+00  42.737  < 2e-16 ***\ncontinentOceania        1.589e+01  5.404e+00   2.939 0.003302 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 85.35 on 5278 degrees of freedom\n  (13 observations effacées parce que manquantes)\nMultiple R-squared:  0.6351,\tAdjusted R-squared:  0.6346 \nF-statistic:  1531 on 6 and 5278 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nLes résultats semblent tous avoir une certaine corrélation, mais certaines variables sont surprenantes. Ce qui remet en cause ces résultats. En premier lieu, oui la génération d'électricité influence positivement le co2, mais il ne semble pas être le facteur avec le plus d'impact. Le continent semble avoir plus d'impact et aux finales cela pourrait s'expliquer par le type de productions qui est utilisé pour faire de l'électricité. Ce qui fait lien avec la variable population qui est négative. Cela pourrait donc s'expliquer du fait que le fait d'avoir une population nombreuse ne signifie pas la production d'électricité est proportionnel à la population.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork)\np1 <- ggplot(data_energi,\n       aes(year, moyenneCo2, color = continent))+\n    geom_line()\n\np2 <- ggplot(data_energi,\n       aes(year, moyenneElec, color = continent))+\n    geom_line()\n\np1+p2\n```\n\n::: {.cell-output-display}\n![](exploration_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nCes deux graphiques montrent tout de même la corrélation qui pourrait exister entre les deux variables. Il est facile de remarquer que les courbes se suivent sauf pour celle de l'Europe et de l'Amérique qui contrairement a la production encore croissante de leur énergie la production de co2 est en faible baisse. Cela s'expliquerait du fait que ces deux continents cherchent à réduire leur production d'électricité via les combustibles fossiles.\n\n## Teste pour connaître le temps écoulé du fichier\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lubridate)\nLife <- expectancy_Co2 %>% \n    mutate(jour_mois = \"-01-01\") %>%\n    unite(year, jour_mois, col = year, sep = \"\") %>% \n    mutate(year_as_date = as.Date(year, format = \"%y-%m-%d\"))\n\nnb_jour <- as.numeric(difftime(as.POSIXct(today()),\n                               as.POSIXct(as.Date(min(Life$year_as_date), format = \"%Y-%m-%d\"))))\n\nnb_jour\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] NA\n```\n:::\n:::\n\n\nCréation d'un fichier csv de la base de donnée data_final.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#datatable(\n#  data_final, extensions = 'Buttons', options = list(\n#    dom = 'Bfrtip',\n#    buttons = c('copy', 'csv')\n#  )\n#)\nwrite.csv(data_final, \"data/raw/data_final.csv\", row.names = FALSE)\n```\n:::\n\n\nLes données proviennent entre autres de:\n\n@owidenergy\n\n@gaplife\n\n@owidco2\n",
    "supporting": [
      "exploration_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}